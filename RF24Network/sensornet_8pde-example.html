<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Newly Optimized RF24Network Layer: sensornet.pde</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Newly Optimized RF24Network Layer
   </div>
   <div id="projectbrief">2014 - Optimized RF24 Network Layer for NRF24L01 radios</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">sensornet.pde</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example of a sensor network.This sketch demonstrates how to use the <a class="el" href="classRF24Network.html" title="2014 - Optimized Network Layer for RF24 Radios ">RF24Network</a> library to manage a set of low-power sensor nodes which mostly sleep but awake regularly to send readings to the base.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> Copyright (C) 2011 James Coliz, Jr. &lt;maniacbug@ymail.com&gt;</span></div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment"> This program is free software; you can redistribute it and/or</span></div>
<div class="line"><span class="comment"> modify it under the terms of the GNU General Public License</span></div>
<div class="line"><span class="comment"> version 2 as published by the Free Software Foundation.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;avr/pgmspace.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="RF24Network_8h.html">RF24Network.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;RF24.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;SPI.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Tictocs.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;Button.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;TictocTimer.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;nodeconfig.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;sleep.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;S_message.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;printf.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// This is for git version tracking.  Safe to ignore</span></div>
<div class="line"><span class="preprocessor">#ifdef VERSION_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;version.h&quot;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define __TAG__ &quot;Unknown&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">// Pin definitions</span></div>
<div class="line"><span class="preprocessor">#ifndef PINS_DEFINED</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define __PLATFORM__ &quot;Getting Started board&quot;</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">// Pins for radio</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> rf_ce = 9;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> rf_csn = 10;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Pins for sensors</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> temp_pin = A2;</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> voltage_pin = A3;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Pins for status LED, or &#39;0&#39; for no LED connected</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> led_red = 0; </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> led_yellow = 0; </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> led_green = 0; </div>
<div class="line"></div>
<div class="line"><span class="comment">// Button to control modes</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> button_a = 4;</div>
<div class="line"></div>
<div class="line"><span class="comment">// What voltage is a reading of 1023?</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">unsigned</span> voltage_reference = 5 * 256; <span class="comment">// 5.0V</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">RF24 radio(rf_ce,rf_csn);</div>
<div class="line"><a name="_a0"></a><a class="code" href="classRF24Network.html">RF24Network</a> network(radio);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Our node configuration </span></div>
<div class="line">eeprom_info_t this_node;</div>
<div class="line"></div>
<div class="line"><span class="comment">// System configuration</span></div>
<div class="line"><span class="keyword">struct </span>K_message_t</div>
<div class="line">{</div>
<div class="line">  uint8_t revision; <span class="comment">/* Which rev of the current system config? */</span></div>
<div class="line">  uint8_t sleep_cycles; <span class="comment">/* How many 8s sleep cycles to wait between transmissions */</span></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">K_message_t system_config = { 0, 0 };</div>
<div class="line"></div>
<div class="line">uint8_t has_recent_system_config = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Number of packets we&#39;ve failed to send since we last sent one</span></div>
<div class="line"><span class="comment">// successfully</span></div>
<div class="line">uint16_t lost_packets = 0;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Sleep constants.  In this example, the watchdog timer wakes up</span></div>
<div class="line"><span class="comment">// every 4s, and every single wakeup we power up the radio and send</span></div>
<div class="line"><span class="comment">// a reading.  In real use, these numbers which be much higher.</span></div>
<div class="line"><span class="comment">// Try wdt_8s and 7 cycles for one reading per minute.&gt; 1</span></div>
<div class="line"><span class="keyword">const</span> wdt_prescalar_e wdt_prescalar = wdt_8s;</div>
<div class="line">uint8_t sleep_cycles_per_transmission = 4;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Non-sleeping nodes need a timer to regulate their sending interval</span></div>
<div class="line">Timer send_timer(8000UL * (uint32_t)sleep_cycles_per_transmission);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Button controls functionality of the unit</span></div>
<div class="line">Button ButtonA(button_a);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Long-press button</span></div>
<div class="line">Button ButtonLong(button_a,1000);</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>LED</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">int</span> pin;</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  LED(<span class="keywordtype">int</span> _pin): pin(_pin)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (pin &gt; 0)</div>
<div class="line">    {</div>
<div class="line">      pinMode(pin,OUTPUT);</div>
<div class="line">      digitalWrite(pin,LOW);</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> write(<span class="keywordtype">bool</span> state)<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">if</span> (pin &gt; 0)</div>
<div class="line">      digitalWrite(pin,state?HIGH:LOW);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> operator=(<span class="keywordtype">bool</span> state)</div>
<div class="line">  {</div>
<div class="line">    write(state);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>StartupLEDs: <span class="keyword">public</span> Timer</div>
<div class="line">{</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">const</span> LED** leds;</div>
<div class="line">  <span class="keyword">const</span> LED** current;</div>
<div class="line">  <span class="keyword">const</span> LED** end;</div>
<div class="line">  <span class="keywordtype">bool</span> state;</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> onFired(<span class="keywordtype">void</span>)</div>
<div class="line">  {</div>
<div class="line">    (*current)-&gt;write(state);</div>
<div class="line">    ++current;</div>
<div class="line">    <span class="keywordflow">if</span> ( current &gt;= end )</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> ( state )</div>
<div class="line">      {</div>
<div class="line">        state = <span class="keyword">false</span>;</div>
<div class="line">        current = leds;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        disable();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  StartupLEDs(<span class="keyword">const</span> LED** _leds, <span class="keywordtype">int</span> _num): Timer(333), leds(_leds), current(_leds), end(_leds+_num), state(true)</div>
<div class="line">  {</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><span class="keyword">class </span>CalibrationLEDs: <span class="keyword">public</span> Timer</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> LED** leds;</div>
<div class="line">  <span class="keyword">const</span> LED** end;</div>
<div class="line">  <span class="keywordtype">bool</span> state;</div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">  <span class="keywordtype">void</span> write()</div>
<div class="line">  {</div>
<div class="line">    <span class="keyword">const</span> LED** current = end;</div>
<div class="line">    <span class="keywordflow">while</span> (current-- &gt; leds)</div>
<div class="line">      (*current)-&gt;write(state);</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">void</span> onFired() </div>
<div class="line">  {</div>
<div class="line">    state = ! state;</div>
<div class="line">    write();</div>
<div class="line">  }</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">  CalibrationLEDs(<span class="keyword">const</span> LED** _leds, <span class="keywordtype">int</span> _num, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> duration = 500): Timer(duration), leds(_leds), end(_leds+_num), state(false)</div>
<div class="line">  {</div>
<div class="line">    Timer::disable();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> begin()</div>
<div class="line">  {</div>
<div class="line">    Updatable::begin();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> reset()</div>
<div class="line">  {</div>
<div class="line">    state = <span class="keyword">true</span>;</div>
<div class="line">    write();</div>
<div class="line">    Timer::reset();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> disable()</div>
<div class="line">  {</div>
<div class="line">    state = <span class="keyword">false</span>;</div>
<div class="line">    write();</div>
<div class="line">    Timer::disable();</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">LED Red(led_red), Yellow(led_yellow), Green(led_green);</div>
<div class="line"></div>
<div class="line"><span class="keyword">const</span> LED* leds[] = { &amp;Red, &amp;Yellow, &amp;Green }; </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> num_leds = <span class="keyword">sizeof</span>(leds)/<span class="keyword">sizeof</span>(leds[0]);</div>
<div class="line">StartupLEDs startup_leds(leds,num_leds);</div>
<div class="line">CalibrationLEDs calibration_leds(leds,num_leds);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Nodes in test mode do not sleep, but instead constantly try to send</span></div>
<div class="line"><span class="keywordtype">bool</span> test_mode = <span class="keyword">false</span>;</div>
<div class="line"><span class="keywordtype">bool</span> user_test_mode = <span class="keyword">false</span>;  <span class="comment">// test mode initiated by user</span></div>
<div class="line"><span class="keywordtype">bool</span> system_test_mode = <span class="keyword">false</span>; <span class="comment">// test mode initiated by system</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Nodes in calibration mode are looking for temperature calibration</span></div>
<div class="line"><span class="keywordtype">bool</span> calibration_mode = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Helper functions to take readings</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// How many measurements to take.  64*1024 = 65536, so 64 is the max we can fit in a uint16_t.</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> num_measurements = 64;</div>
<div class="line"></div>
<div class="line">uint32_t measure_temp()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> i = num_measurements;</div>
<div class="line">    uint32_t reading = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(i--)</div>
<div class="line">      reading += analogRead(temp_pin);</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Convert the reading to celcius*256</span></div>
<div class="line">    <span class="comment">// This is the formula for MCP9700.</span></div>
<div class="line">    <span class="comment">// C = reading * 1.1</span></div>
<div class="line">    <span class="comment">// C = ( V - 1/2 ) * 100</span></div>
<div class="line">    <span class="comment">//</span></div>
<div class="line">    <span class="comment">// Then adjust for the calibation value on this sensor</span></div>
<div class="line">    <span class="keywordflow">return</span> ( ( ( ( reading * 0x120 ) - 0x800000 ) * 0x64 ) &gt;&gt; 16 ) + this_node.temp_calibration;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">uint32_t measure_voltage()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Take the voltage reading </span></div>
<div class="line">    <span class="keywordtype">int</span> i = num_measurements;</div>
<div class="line">    uint32_t reading = 0;</div>
<div class="line">    <span class="keywordflow">while</span>(i--)</div>
<div class="line">      reading += analogRead(voltage_pin);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Convert the voltage reading to volts*256</span></div>
<div class="line">    <span class="keywordflow">return</span> ( reading * voltage_reference ) &gt;&gt; 16; </div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keyword">struct </span>CalibrationData</div>
<div class="line">{</div>
<div class="line">  uint8_t measurements_remaining;</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> uint8_t measurements_needed = 16;</div>
<div class="line">  int16_t accumulator;</div>
<div class="line"></div>
<div class="line">  CalibrationData()</div>
<div class="line">  {</div>
<div class="line">    measurements_remaining = measurements_needed;</div>
<div class="line">    accumulator = 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">void</span> add(int16_t reading)</div>
<div class="line">  {</div>
<div class="line">    accumulator += reading / measurements_needed;</div>
<div class="line">    <span class="keywordflow">if</span> ( measurements_remaining )</div>
<div class="line">      --measurements_remaining;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">bool</span> done()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> measurements_remaining == 0;</div>
<div class="line">  }</div>
<div class="line">  int16_t result()<span class="keyword"> const</span></div>
<div class="line"><span class="keyword">  </span>{</div>
<div class="line">    <span class="keywordflow">return</span> accumulator;</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">CalibrationData calibration_data;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> setup(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Print preamble</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  </div>
<div class="line">  Serial.begin(57600);</div>
<div class="line">  printf_begin();</div>
<div class="line">  <a name="a1"></a><a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a name="a2"></a><a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;\n\rRF24Network/examples/sensornet/\n\r&quot;</span>));</div>
<div class="line">  <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;PLATFORM: &quot;</span> __PLATFORM__ <span class="stringliteral">&quot;\n\r&quot;</span>));</div>
<div class="line">  <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;VERSION: &quot;</span> __TAG__ <span class="stringliteral">&quot;\n\r&quot;</span>));</div>
<div class="line">  </div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Pull node address out of eeprom </span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Which node are we?</span></div>
<div class="line">  this_node = nodeconfig_read();</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Prepare sleep parameters</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <span class="comment">// Only the leaves sleep. </span></div>
<div class="line">  <span class="keywordflow">if</span> ( ! this_node.relay )</div>
<div class="line">    Sleep.begin(wdt_prescalar,sleep_cycles_per_transmission);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Set up board hardware</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  ButtonA.begin();</div>
<div class="line">  ButtonLong.begin();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Sensors use the stable internal 1.1V voltage</span></div>
<div class="line"><span class="preprocessor">#ifdef INTERNAL1V1</span></div>
<div class="line"><span class="preprocessor"></span>  analogReference(INTERNAL1V1);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>  analogReference(INTERNAL);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">  <span class="comment">// Prepare the startup sequence</span></div>
<div class="line">  send_timer.begin();</div>
<div class="line">  startup_leds.begin();</div>
<div class="line">  calibration_leds.begin();</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Bring up the RF network</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a name="a3"></a><a class="code" href="RF24Network__config_8h.html#a2332dcef61deaf30b01014f3bede4343">SPI</a>.begin();</div>
<div class="line">  radio.begin();</div>
<div class="line">  network.begin(<span class="comment">/*channel*/</span> 92, <span class="comment">/*node address*/</span> this_node.address);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">// Request configuration from parent</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line"></div>
<div class="line">  <a name="_a4"></a><a class="code" href="structRF24NetworkHeader.html">RF24NetworkHeader</a> header(network.parent(),<span class="charliteral">&#39;k&#39;</span>);</div>
<div class="line">  <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Sending type-%c to 0%o...\n\r&quot;</span>),millis(),header.type,header.to_node);</div>
<div class="line">  <span class="keywordflow">if</span> ( ! network.write(header,NULL,0) )</div>
<div class="line">    <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;Failed.\r\n&quot;</span>));</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> loop(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Update objects</span></div>
<div class="line">  theUpdater.update();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Pump the network regularly</span></div>
<div class="line">  network.update();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Is there anything ready for us?</span></div>
<div class="line">  <span class="keywordflow">while</span> ( network.available() )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// If so, grab it and print it out</span></div>
<div class="line">    <a class="code" href="structRF24NetworkHeader.html">RF24NetworkHeader</a> header;</div>
<div class="line">    network.peek(header);</div>
<div class="line">    <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Received #%u type %c from 0%o\n\r&quot;</span>),millis(),header.<a name="a5"></a><a class="code" href="structRF24NetworkHeader.html#ad05daaac28b7d1e7a7ef749f7f0ce317">id</a>,header.<a name="a6"></a><a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a>,header.<a name="a7"></a><a class="code" href="structRF24NetworkHeader.html#aff9461f6546b5b7c87465809eb4f9f56">from_node</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Child node is just testing</span></div>
<div class="line">    <span class="keywordflow">if</span> ( header.<a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a> == <span class="charliteral">&#39;t&#39;</span> )</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// clear message from queue</span></div>
<div class="line">      network.read(header,NULL,0);</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Handle config messages</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( header.<a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a> == <span class="charliteral">&#39;k&#39;</span> )</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// child is requesting a configuration from us</span></div>
<div class="line">      network.read(header,NULL,0);</div>
<div class="line">      <a class="code" href="structRF24NetworkHeader.html">RF24NetworkHeader</a> response_header(<span class="comment">/*to node*/</span> header.<a class="code" href="structRF24NetworkHeader.html#aff9461f6546b5b7c87465809eb4f9f56">from_node</a>, <span class="comment">/*type*/</span> <span class="charliteral">&#39;K&#39;</span>);</div>
<div class="line">      network.write(response_header,&amp;system_config,<span class="keyword">sizeof</span>(system_config));</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Sending new config #%i: %i to 0%o\n\r&quot;</span>),millis(),system_config.revision,system_config.sleep_cycles,header.<a class="code" href="structRF24NetworkHeader.html#aff9461f6546b5b7c87465809eb4f9f56">from_node</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( header.<a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a> == <span class="charliteral">&#39;K&#39;</span> )</div>
<div class="line">    {</div>
<div class="line">      has_recent_system_config = <span class="keyword">true</span>;</div>
<div class="line">      <span class="comment">// parent has sent a configuration to us</span></div>
<div class="line">      K_message_t message;</div>
<div class="line">      network.read(header,&amp;message,<span class="keyword">sizeof</span>(message));</div>
<div class="line">      <span class="keywordflow">if</span> ( message.revision &gt; system_config.revision )</div>
<div class="line">      {</div>
<div class="line">        memcpy(&amp;system_config,&amp;message,<span class="keyword">sizeof</span>(system_config));</div>
<div class="line">        <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Accepted new config #%i: %i\n\r&quot;</span>),millis(),system_config.revision,system_config.sleep_cycles);</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Act on the new configuration!!</span></div>
<div class="line">        sleep_cycles_per_transmission = system_config.sleep_cycles; </div>
<div class="line">        send_timer.setInterval(8000UL * (uint32_t)sleep_cycles_per_transmission);</div>
<div class="line">        Sleep.setSleepCycles(sleep_cycles_per_transmission);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// If we have a temp sensor AND we are not sleeping</span></div>
<div class="line">    <span class="keywordflow">if</span> ( temp_pin &gt; -1 &amp;&amp; ( ! Sleep || test_mode ) )</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// if the received message is a calibration request &#39;c&#39; message, we can respond</span></div>
<div class="line">      <span class="comment">// with a callibration response &#39;C&#39; message in return</span></div>
<div class="line">      <span class="keywordflow">if</span> ( header.<a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a> == <span class="charliteral">&#39;c&#39;</span> )</div>
<div class="line">      {</div>
<div class="line">        <span class="comment">// clear message from queue</span></div>
<div class="line">        network.read(header,NULL,0);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Take a reading</span></div>
<div class="line">        S_message response;</div>
<div class="line">        response.temp_reading = measure_temp(); </div>
<div class="line">        response.voltage_reading = measure_voltage();</div>
<div class="line"></div>
<div class="line">        <span class="comment">// Send it back as a calibration message</span></div>
<div class="line">        <a class="code" href="structRF24NetworkHeader.html">RF24NetworkHeader</a> response_header(<span class="comment">/*to node*/</span> header.<a class="code" href="structRF24NetworkHeader.html#aff9461f6546b5b7c87465809eb4f9f56">from_node</a>, <span class="comment">/*type*/</span> <span class="charliteral">&#39;C&#39;</span>);</div>
<div class="line">        network.write(response_header,&amp;response,<span class="keyword">sizeof</span>(response));</div>
<div class="line">        <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Sending calibration to 0%o\n\r&quot;</span>),millis(),header.<a class="code" href="structRF24NetworkHeader.html#aff9461f6546b5b7c87465809eb4f9f56">from_node</a>);</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( header.<a class="code" href="structRF24NetworkHeader.html#ac99ab14e561670f4445d1fea7775e2db">type</a> == <span class="charliteral">&#39;C&#39;</span> )</div>
<div class="line">      {</div>
<div class="line">        S_message message;</div>
<div class="line">        network.read(header,&amp;message,<span class="keyword">sizeof</span>(message));</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// This is a calibration response message</span></div>
<div class="line">        <span class="keywordflow">if</span> ( calibration_mode )</div>
<div class="line">        {</div>
<div class="line">          <span class="comment">// Calculate the diff</span></div>
<div class="line">          uint16_t diff = message.temp_reading - measure_temp();</div>
<div class="line">          <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Calibration received %04x diff %04x\n\r&quot;</span>),millis(),message.temp_reading,diff);</div>
<div class="line">          calibration_data.add(diff);</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">if</span> ( calibration_data.done() )</div>
<div class="line">          {</div>
<div class="line">            calibration_mode = <span class="keyword">false</span>;</div>
<div class="line">            calibration_leds.disable();</div>
<div class="line">            <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Stop calibration mode. Calibrate by %04x\n\r&quot;</span>),millis(),calibration_data.result());</div>
<div class="line"></div>
<div class="line">            <span class="comment">// Now apply the calibration</span></div>
<div class="line">            this_node.temp_calibration += calibration_data.result();</div>
<div class="line">            <span class="comment">// And save it to eeprom...</span></div>
<div class="line">            set_temp_calibration( this_node.temp_calibration );</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Handle the quest for a system config response message (&#39;K&#39;).  If we haven&#39;t gotten one by the</span></div>
<div class="line">  <span class="comment">// time the startup LED&#39;s finish, we&#39;ll go into test mode for a while looking for one.</span></div>
<div class="line">  <span class="keywordflow">if</span> ( !has_recent_system_config &amp;&amp; millis() &lt; 10000 )</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> ( ! system_test_mode )</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Start system config mode\n\r&quot;</span>),millis());</div>
<div class="line"></div>
<div class="line">    system_test_mode = <span class="keyword">true</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> ( system_test_mode )</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Stop system config mode\n\r&quot;</span>),millis());</div>
<div class="line">    </div>
<div class="line">    system_test_mode = <span class="keyword">false</span>;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordtype">bool</span> old_test_mode = test_mode;</div>
<div class="line">  test_mode = system_test_mode || user_test_mode;</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">if</span> ( test_mode &amp;&amp; ! old_test_mode )</div>
<div class="line">    send_timer.setInterval(2000);</div>
<div class="line">  <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !test_mode &amp;&amp; old_test_mode )</div>
<div class="line">  {</div>
<div class="line">    send_timer.setInterval(8000UL * (uint32_t)sleep_cycles_per_transmission);</div>
<div class="line">    Green = <span class="keyword">false</span>;</div>
<div class="line">    Red = <span class="keyword">false</span>;</div>
<div class="line">    lost_packets = 0;</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// If we are the kind of node that sends readings, </span></div>
<div class="line">  <span class="comment">// AND we have a temp sensor</span></div>
<div class="line">  <span class="comment">// AND it&#39;s time to send a reading </span></div>
<div class="line">  <span class="comment">// AND we&#39;re in the mode where we send readings...</span></div>
<div class="line">  <span class="keywordflow">if</span> ( this_node.address &gt; 0 &amp;&amp; temp_pin &gt; -1 &amp;&amp; ( ( Sleep &amp;&amp; ! test_mode ) || send_timer.wasFired() ) &amp;&amp; ! startup_leds )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Transmission beginning, TX LED ON</span></div>
<div class="line">    Yellow = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordflow">if</span> ( test_mode &amp;&amp; ! calibration_mode )</div>
<div class="line">    {</div>
<div class="line">      Green = <span class="keyword">false</span>;</div>
<div class="line">      Red = <span class="keyword">false</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    S_message message;</div>
<div class="line">    message.temp_reading = measure_temp(); </div>
<div class="line">    message.voltage_reading = measure_voltage(); </div>
<div class="line">    message.lost_packets = min(lost_packets,0xff);</div>
<div class="line"></div>
<div class="line">    <span class="keywordtype">char</span> message_type = <span class="charliteral">&#39;S&#39;</span>;</div>
<div class="line">    <span class="keywordflow">if</span> ( calibration_mode )</div>
<div class="line">      message_type = <span class="charliteral">&#39;c&#39;</span>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (test_mode)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// If we still don&#39;t have a config, we&#39;ll use our test mode to keep asking for them</span></div>
<div class="line">      <span class="keywordflow">if</span> ( ! has_recent_system_config )</div>
<div class="line">        message_type = <span class="charliteral">&#39;k&#39;</span>;</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">        message_type = <span class="charliteral">&#39;t&#39;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// By default send to the base</span></div>
<div class="line">    uint16_t to_node = 0;</div>
<div class="line">    <span class="keywordflow">if</span> ( test_mode ) </div>
<div class="line">      <span class="comment">// In test mode, sent to our parent.</span></div>
<div class="line">      to_node = network.parent();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;---------------------------------\n\r&quot;</span>));</div>
<div class="line">    <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Sending type-%c %s to 0%o...\n\r&quot;</span>),millis(),message_type,message.toString(),to_node);</div>
<div class="line">   </div>
<div class="line">    <a class="code" href="structRF24NetworkHeader.html">RF24NetworkHeader</a> header(to_node,message_type);</div>
<div class="line">    <span class="keywordtype">bool</span> ok = network.write(header,&amp;message,<span class="keyword">sizeof</span>(message));</div>
<div class="line">    <span class="keywordflow">if</span> (ok)</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> ( test_mode &amp;&amp; ! calibration_mode )</div>
<div class="line">        Green = <span class="keyword">true</span>;</div>
<div class="line">      lost_packets = 0;</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Send ok\n\r&quot;</span>),millis());</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">      <span class="keywordflow">if</span> ( test_mode &amp;&amp; ! calibration_mode )</div>
<div class="line">        Red = <span class="keyword">true</span>;</div>
<div class="line">      ++lost_packets;</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Send failed\n\r&quot;</span>),millis());</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Transmission complete, TX LED OFF</span></div>
<div class="line">    Yellow = <span class="keyword">false</span>;</div>
<div class="line">   </div>
<div class="line">    <span class="keywordflow">if</span> ( Sleep &amp;&amp; ! test_mode ) </div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Power down the radio.  Note that the radio will get powered back up</span></div>
<div class="line">      <span class="comment">// on the next write() call.</span></div>
<div class="line">      radio.powerDown();</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Be sure to flush the serial first before sleeping, so everything</span></div>
<div class="line">      <span class="comment">// gets printed properly</span></div>
<div class="line">      Serial.flush();</div>
<div class="line">      </div>
<div class="line">      <span class="comment">// Sleep the MCU.  The watchdog timer will awaken in a short while, and</span></div>
<div class="line">      <span class="comment">// continue execution here.</span></div>
<div class="line">      Sleep.go();</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Button</span></div>
<div class="line">  <span class="keywordtype">unsigned</span> a = ButtonA.wasReleased();</div>
<div class="line">  <span class="keywordflow">if</span> ( a &amp;&amp; a &lt; 500 )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Pressing the button during startup sequences engages test mode.</span></div>
<div class="line">    <span class="comment">// Pressing it after turns off test mode.</span></div>
<div class="line">    <span class="keywordflow">if</span> ( startup_leds )</div>
<div class="line">    {</div>
<div class="line">      user_test_mode = <span class="keyword">true</span>;</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Start test mode\n\r&quot;</span>),millis());</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( calibration_mode )</div>
<div class="line">    {</div>
<div class="line">      calibration_mode = <span class="keyword">false</span>;</div>
<div class="line">      calibration_leds.disable();</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Stop calibration mode\n\r&quot;</span>),millis());</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( user_test_mode )</div>
<div class="line">    {</div>
<div class="line">      user_test_mode = <span class="keyword">false</span>;</div>
<div class="line">      <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Stop test mode\n\r&quot;</span>),millis());</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Long press</span></div>
<div class="line">  <span class="keywordflow">if</span> ( ButtonLong.wasPressed() &amp;&amp; user_test_mode )</div>
<div class="line">  {</div>
<div class="line">    calibration_mode = <span class="keyword">true</span>;</div>
<div class="line">    calibration_leds.reset();</div>
<div class="line">    calibration_data = CalibrationData();</div>
<div class="line">    <a class="code" href="RF24Network__config_8h.html#a758ad569cbda7c5ddfaa902e8eed3360">printf_P</a>(<a class="code" href="RF24Network__config_8h.html#a9c00057fd19e916cc1aa0a5949336beb">PSTR</a>(<span class="stringliteral">&quot;%lu: APP Start calibration mode\n\r&quot;</span>),millis());</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Listen for a new node address</span></div>
<div class="line">  nodeconfig_listen();</div>
<div class="line">}</div>
<div class="line"><span class="comment">// vim:ai:cin:sts=2 sw=2 ft=cpp</span></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 1 2014 22:35:05 for Newly Optimized RF24Network Layer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
