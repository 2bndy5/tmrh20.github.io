<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Newly Optimized RF24Network Layer: Performance and Data Loss: Tuning the Network</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Newly Optimized RF24Network Layer
   </div>
   <div id="projectbrief">2014 - Optimized RF24 Network Layer for NRF24L01 radios</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Performance and Data Loss: Tuning the Network </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Tips and examples for tuning the network and Dual-head operation.</p>
<div class="image">
<img src="tmrh20/topologyImage.jpg"  alt="Topology" height="75%" width="75%"/>
</div>
<h1><a class="anchor" id="TuningOverview"></a>
Tuning Overview</h1>
<p>The RF24 radio modules are generally only capable of either sending or receiving data at any given time, but have built-in auto-retry mechanisms to prevent the loss of data. These values are adjusted automatically by the library on startup, but can be further adjusted to reduce data loss, and thus increase throughput of the network. This page is intended to provide a general overview of its operation within the context of the network library, and provide guidance for adjusting these values.</p>
<h1><a class="anchor" id="RetryTiming"></a>
Auto-Retry Timing</h1>
<p>The core radio library provides the functionality of adjusting the internal auto-retry interval of the radio modules. In the network configuration, the radios can be set to automatically retry failed transmissions at intervals ranging anywhere from 500us (.5ms) up to 4000us (4ms). When operating any number of radios larger than two, it is important to stagger the assigned intervals, to prevent the radios from interfering with each other at the radio frequency (RF) layer.</p>
<p>The library should provide fairly good working values, as it simply staggers the assigned values within groups of radios in direct communication. This value can be set manually by calling radio.setRetries(X,15); and adjusting the value of X from 1 to 15 (steps of 250us).</p>
<h1><a class="anchor" id="AutoRetry"></a>
Auto-Retry Count and Extended Timeouts</h1>
<p>The core radio library also provides the ability to adjust the internal auto-retry count of the radio modules. The default setting is 15 automatic retries per payload, and can be extended by configuring the network.txTimeout variable. This default retry count should generally be left at 15, as per the example in the above section. An interval/retry setting of (15,15) will provide 15 retrys at intervals of 4ms, taking up to 60ms per payload. The library now provides staggered timeout periods by default, but they can also be adjusted on a per-node basis.</p>
<p>The txTimeout variable is used to extend the retry count to a defined duration in milliseconds. See the network.txTimeout variable. Timeout periods of extended duration (500+) will generally not help when payloads are failing due to data collisions, it will only extend the duration of the errors. Extended duration timeouts should generally only be configured on leaf nodes that do not receive data, or on a dual-headed node.</p>
<h1><a class="anchor" id="Examples"></a>
Examples</h1>
<p><b>Example 1:</b> Network with master node and three leaf nodes that send data to the master node. None of the leaf nodes need to receive data.</p>
<p>a: Master node uses default configuration<br/>
 b: Leaf nodes can be configured with extended timeout periods to ensure reception by the master.<br/>
 c: </p>
<div class="fragment"><div class="line">Leaf 01: network.txTimeout = 500;   Leaf 02: network.txTimeout = 573;  Leaf 03: network.txTimeout = 653;</div>
</div><!-- fragment --><p> This configuration will provide a reduction in errors, as the timeouts have been extended, and are staggered between devices.</p>
<p><b>Example 2:</b> Network with master node and three leaf nodes that send data to the master node. The second leaf node needs to receive configuration data from the master at set intervals of 1 second, and send data back to the master node. The other leaf nodes will send basic sensor information every few seconds, and a few dropped payloads will not affect the operation greatly.</p>
<p>a: Master node configured with extended timeouts of .5 seconds, and increased retry delay: </p>
<div class="fragment"><div class="line">radio.setRetries(11,15);</div>
<div class="line">network.txTimeout(500);</div>
</div><!-- fragment --><p> b: Second leaf node configured with a similar timeout period and retry delay: </p>
<div class="fragment"><div class="line">radio.setRetries(8,15);</div>
<div class="line">network.txTimeout(553);</div>
</div><!-- fragment --><p> c: First and third leaf nodes configured with default timeout periods or slightly increased timout periods.</p>
<h1><a class="anchor" id="DualHead"></a>
Dual Headed Operation</h1>
<p>The library now supports a dual radio configuration to further enhance network performance, while reducing errors on busy networks. Master nodes or relay nodes with a large number of child nodes can benefit greatly from a dual headed configuration, since one radio is used for receiving, and the other entirely for transmission.</p>
<p>To configure a dual headed node:</p>
<ol type="1">
<li>Edit the <a class="el" href="RF24Network__config_8h.html">RF24Network_config.h</a> file, and uncomment #define DUAL_HEAD_RADIO</li>
<li>Connect another radio, using the same MOSI, MISO, and SCK lines.</li>
<li>Choose another two pins to use for CE and CS on the second radio. Connect them.</li>
<li>Setup the radio and network like so:</li>
</ol>
<div class="fragment"><div class="line">      RF24 radio(7,8);                        <span class="comment">// Using CE (7) and CS (8) for first radio</span></div>
<div class="line">      RF24 radio1(4,5);                       <span class="comment">// Using CE (4) and CS (5) for second radio</span></div>
<div class="line">      <a class="code" href="classRF24Network.html">RF24Network</a> network(radio,radio1);      <span class="comment">// Set up the network using both radios</span></div>
<div class="line"></div>
<div class="line">Then in setup(), call radio.begin(); and radio1.begin(); before network.begin();</div>
</div><!-- fragment --><ol type="1">
<li>Upload to MCU. The node will now use the first radio to receive data, and radio1 to transmit, preventing data loss on a busy network.</li>
<li>Re-comment the #define in the config file as required if configuring other single-headed radios.</li>
</ol>
<p>Any node can be configured in dual-head mode. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jun 16 2014 11:29:53 for Newly Optimized RF24Network Layer by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
