<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9"/>
<title>RF24Ethernet - TCP/IP over RF24Network: RF24Ethernet library: TCP/IP over RF24Network</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RF24Ethernet - TCP/IP over RF24Network
   &#160;<span id="projectnumber">1.2b</span>
   </div>
   <div id="projectbrief">TMRh20 - Pushing the practical limits of RF24 modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">RF24Ethernet library: TCP/IP over RF24Network </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The RF24Ethernet library was initially designed as an experiment and potential testing tool for <a href="http://tmrh20.github.io/RF24Network_Dev/RF24Network">RF24Network </a>, an OSI Layer 3 network driver, allowing a Raspberry Pi to act as a TCP/IP gateway or host for connected sensor nodes. An Arduino can interface with any Linux machine or SLIP capable device supporting USB, or preferably, an RPi runs companion software, RF24toTUN, which creates a network interface linked to the RF24 radio network. This interface can be further linked to the local network or internet. This allows the RPi or Arduino gateway to perform automatic discovery and routing of TCP/IP data, with no required pre-configuration or interaction from the user beyond assigning appropriate addresses to the nodes initially.</p>
<h1><a class="anchor" id="What"></a>
What does it do?</h1>
<p>RF24Ethernet creates a network of internet enabled RF24/Arduino sensors. It provides an API and interface very similar to the Arduino Ethernet library, to allow sensor nodes to connect out to local or internet based devices to retrieve or send information, or be connected to from the internet or your local network directly.</p>
<p>Sensor nodes can act as individual web servers, simple command-and-control servers, or can connect out as required via TCP/IP.</p>
<h1><a class="anchor" id="How"></a>
How does it work?</h1>
<p>RF24Ethernet utilizes the UIP TCP/IP stack, allowing Arduino devices to use a Raspberry Pi running RF24toTUN or Arduino as a gateway to your network or the internet, or simply as a repository for sensor information. The RF24, RF24Network and optionally RF24Mesh libraries handle the underlying routing, addressing etc. so users do not need to be familiar with the radio modules or libraries.</p>
<p>RF24Network addresses need to be assigned as MAC addresses, and IP addresses can be configured as desired by the user. The master node (00) uses either the Address Resolution Protocol (ARP) or RF24Mesh to find the appropriate nodes when IP traffic is sent though, and routes traffic to the correct RF24Network address.</p>
<p>This provides a fairly seamless interaction, since users only need to configure standard IP forwarding and firewall rules as desired.</p>
<p>The RF24 libraries are based on the <a href="http://en.wikipedia.org/wiki/OSI_model">OSI model</a>:<br />
 </p><table class="doxtable">
<tr>
<th>System </th><th>OSI Layer </th><th>Description  </th></tr>
<tr>
<td><b>NRF24L01 Radio Modules</b> </td><td>OSI Layer 1 (Physical) </td><td>Transmission and reception of the raw bit stream over the physical medium. </td></tr>
<tr>
<td><b>RF24 Core Radio Driver</b> </td><td>OSI Layer 2 (Data Link)</td><td>Transfer of data frames over the physical link. Establish/Terminate logical links between nodes. Manage acknowledgements, error checking </td></tr>
<tr>
<td><b>RF24Network</b> </td><td>OSI Layer 3 (Network) </td><td>Routing, subnets, subnet traffic control, logical-to-physical address mapping, frame fragmentation/reassembly. </td></tr>
<tr>
<td><b>RF24Ethernet (uIP)</b> </td><td>OSI Layer 4 (Transport)</td><td>Ensures error-free messages. Manages sequencing, losses, retries, and duplicates. </td></tr>
<tr>
<td><b>RF24Ethernet (core)</b> </td><td>OSI Layer 5 (Session) </td><td>Establish, maintain, and terminate connections </td></tr>
<tr>
<td><b>RF24Mesh</b> -Optional- </td><td>OSI Layer 7 (Application)</td><td>Provides DHCP/DNS type protocols and allows dynamic addressing/topology for RF24Network. </td></tr>
</table>
<h1><a class="anchor" id="News"></a>
Update News</h1>
<dl class="section version"><dt>Version</dt><dd><b>1.23b - Jan 22 2015</b><ul>
<li>Small bugfixes from v1.20</li>
<li>Slightly reduced latency</li>
<li>Code clean-up/Reduce code size and memory usage for main Client/Server code</li>
<li>Cleaned up some examples, added DNS and SimpleServer_Minimal examples</li>
</ul>
</dd>
<dd>
<b>1.221b - Jan 16 2015</b><ul>
<li>Add UDP support</li>
<li>Add DNS support</li>
<li>Add support for up to 512 byte buffer size</li>
<li>Reduce used memory and program space</li>
<li>Support for multiple connections with per-connection memory buffers</li>
</ul>
</dd>
<dd>
<b>1.1b - Jan 4 2015</b><ul>
<li>Add connection timeout to recover from hangs during failed client downloads</li>
<li>Better TCP window management to prevent hangs during client downloads</li>
<li>Stability improvements</li>
</ul>
</dd>
<dd>
<b>1.0b - Dec 2014</b><ul>
<li>Outgoing client data corruption should be fixed</li>
</ul>
</dd></dl>
<h1><a class="anchor" id="Config"></a>
Configuration and Setup</h1>
<p>RF24Ethernet requires the RF24 and RF24Network_DEV libraries (optionally RF24Mesh) see <a href="http://tmrh20.github.io">http://tmrh20.github.io</a> for documentation and downloads <br />
 <br />
 <b> RPi </b> On the Raspberry Pi, a companion program, RF24toTUN must be installed along with the RF24 and RF24Network libraries</p>
<p>See the video at <a href="https://www.youtube.com/watch?v=rBAIqAaRu0g">https://www.youtube.com/watch?v=rBAIqAaRu0g</a> for a walk-through of the software setup with Raspberry Pi and Arduino.</p>
<ol type="1">
<li><div class="fragment"><div class="line">wget http:<span class="comment">//tmrh20.github.io/RF24Installer/RPi/install.sh  </span></div>
</div><!-- fragment --></li>
<li><div class="fragment"><div class="line">chmod +x install.sh  </div>
</div><!-- fragment --></li>
<li><div class="fragment"><div class="line">./install.sh  </div>
</div><!-- fragment --></li>
<li>Edit the included rf24totun_configAndPing.sh to modify the IP information to suit your desired network config</li>
<li><div class="fragment"><div class="line">sudo ./rf24totun_configAndPing.sh 2 3 </div>
</div><!-- fragment --></li>
<li>The '2' specifies the last octet of the RPi IP address. The '3' specifies the last octet of the node it will attempt to ping once started.</li>
<li>Raspberry Pi defaults to the master node (00). Secondary Raspberry pi nodes need to specify their RF24Network address or RF24Mesh nodeID.</li>
</ol>
<p><b> Arduino </b></p><ol type="1">
<li>For Arduino devices, the RF24, RF24Network and RF24Ethernet libraries need to be installed ( see <a href="http://tmrh20.github.io">http://tmrh20.github.io</a> )</li>
<li>Open the included Getting_Started_SimpleServer or Getting_Started_SimpleClient example</li>
<li>Configure your chosen CE and CS pins for the radio connection.</li>
<li>Configure the RF24Network address (see <a href="http://tmrh20.github.io/RF24Network_Dev/">http://tmrh20.github.io/RF24Network_Dev/</a> for more info)</li>
<li>Configure the IP address according to your preferences, with the gateway set to the chosen IP of the RPi.</li>
<li>Connect into your nodes web-server at <a href="http://ip-of-your-node:1000">http://ip-of-your-node:1000</a> from the RPi or configure the client sketch to connect to a server running on the Raspberry Pi. Note: To minimize memory usage on Arduino, edit RF24Network_config.h with a text editor, and uncomment #define DISABLE_USER_PAYLOADS. This will disable standard RF24Network messages, and only allow external data, such as TCP/IP information.</li>
</ol>
<p><b> Non-Raspberry Pi (Linux etc) Devices </b><br />
 Arduino can also function as a gateway for any Linux machine or PC/MAC that supports SLIP. <br />
 See the SLIP_Gateway and SLIP_InteractiveServer examples for usage without the need for a Raspberry Pi.</p>
<p><b>Accessing External Systems: Forwarding and Routing</b></p>
<p>In order to give your network or nodes access to your network or the internet beyond the RPi, it needs to be configured to route traffic between the networks.</p><ol type="1">
<li>Run<div class="fragment"><div class="line">sudo sysctl -w net.ipv4.ip_forward=1 </div>
</div><!-- fragment --> to allow the RPi to forward requests between the network interfaces</li>
<li><div class="fragment"><div class="line">sudo iptables -t nat -A POSTROUTING -j MASQUERADE </div>
</div><!-- fragment --> to allow the RPi to perform NAT between the network interfaces <br />
</li>
</ol>
<dl class="section note"><dt>Note</dt><dd>This configuration is generally for initial testing only. Users may also need to add a static route to their local machine, or configure port forwarding on the RPi.<br />
 See the following links for more information on configuring and using IPTables:<br />
 <a href="http://www.karlrupp.net/en/computer/nat_tutorial">http://www.karlrupp.net/en/computer/nat_tutorial</a><br />
 <a href="http://serverfault.com/questions/326493/basic-iptables-nat-port-forwarding">http://serverfault.com/questions/326493/basic-iptables-nat-port-forwarding</a></dd></dl>
<dl class="section warning"><dt>Warning</dt><dd><b>Note:</b> Users are responsible to manage further routing rules along with their IP traffic in order to prevent unauthorized access.</dd></dl>
<h1><a class="anchor" id="Advanced"></a>
Advanced Configuration and Info</h1>
<p>See the <a href="group__UipConfiguration.html">User Configuration</a> section for modifying <a class="el" href="uip-conf_8h_source.html">uip-conf.h</a></p>
<h1><a class="anchor" id="Troubleshooting"></a>
Troubleshooting</h1>
<p>The RF24 libraries are divided into layers, generally according to the OSI model, which allows specialized testing and troubleshooting of individual layers.</p>
<p>See the <a href="Troubleshooting.html">Troubleshooting</a> section for general troubleshooting steps.</p>
<h1><a class="anchor" id="TAP_TUN"></a>
TAP vs TUN</h1>
<p>RF24Ethernet and RF24toTUN are able to utilize both TAP and TUN type interfaces. <br />
 <b> TAP </b> A TAP interface can be looked at much the same as an Ethernet interface, Ethernet headers are used to identify devices via MAC address, and the Address Resolution Protocol (ARP) is used to perform that identification. <br />
 <b> TUN </b> A TUN interface does not utilize Ethernet headers, MAC addresses or ARP, in this case relying on RF24Mesh/IP routing instead.</p>
<h1><a class="anchor" id="Limitations"></a>
Limitations</h1>
<p>UDP frames can be up to 512 bytes in length, so UDP/DNS is limited by available memory, and the defined MAX_PAYLOAD_SIZE / UIP_BUFFER_SIZE. If a DNS request exceeds the maximum allowed size, it will be dropped. DNS responses for addresses such as 'www.google.com' tend to be much smaller than requests for 'google.com', and will generally work with the default configuration.</p>
<h1><a class="anchor" id="MAC_Addys"></a>
MAC address formatting:</h1>
<p>RF24Ethernet uses a simple method of formatting the MAC addresses, using the first four bytes to store the characters 'RF24', and the last two bytes to store the RF24Network address, which makes identification of nodes via MAC address very simple using standard monitoring tools.</p>
<table class="doxtable">
<tr>
<th>RF24Network Address</th><th>Byte 0 </th><th>Byte 1 </th><th>Byte 2 </th><th>Byte 3 </th><th>Byte 4 </th><th>Byte 5  </th></tr>
<tr>
<td>n/a </td><td>R </td><td>F </td><td>2 </td><td>4 </td><td>Octal LB</td><td>Octal HB </td></tr>
<tr>
<td>01 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td><td>0x01 </td><td>0x00 </td></tr>
<tr>
<td>011 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td><td>0x09 </td><td>0x00 </td></tr>
<tr>
<td>0443 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td><td>0x23 </td><td>0x01 </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Feb 14 2015 13:54:58 for RF24Ethernet - TCP/IP over RF24Network by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9
</small></address>
</body>
</html>
