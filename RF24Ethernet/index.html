<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>RF24Ethernet - TCP/IP over RF24Network: RF24Ethernet library: TCP/IP over RF24Network</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">RF24Ethernet - TCP/IP over RF24Network
   &#160;<span id="projectnumber">Beta 0.0</span>
   </div>
   <div id="projectbrief">TMRh20 - Pushing the practical limits of RF24 modules</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">RF24Ethernet library: TCP/IP over RF24Network </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Overview"></a>
Overview</h1>
<p>The RF24Ethernet library was initially designed as an experiment and potential testing tool for RF24Network, allowing a Raspberry Pi to act as a TCP/IP gateway or host for connected sensor nodes. The RPi runs companion software, RF24toTUN, which creates a network interface linked to the RF24 radio network, which can be further linked to the local network or internet. This allows the RPi to perform automatic discovery and routing of TCP/IP data, with no required pre-configuration or interaction from the user beyond assigning appropriate addresses to the nodes initially.</p>
<h1><a class="anchor" id="What"></a>
What does it do?</h1>
<p>RF24Ethernet provides an API and interface very similar to the Arduino Ethernet library, to allow sensor nodes to connect out to local or internet based devices to retrieve or send information, or be connected to from the internet or your local network directly. Sensor nodes can act as individual web servers, simple command-and-control servers, or can connect out as required via TCP/IP.</p>
<h1><a class="anchor" id="How"></a>
How does it work?</h1>
<p>RF24Ethernet utilizes the UIP TCP/IP stack to provide communication, allowing Arduino devices to use a Raspberry Pi running RF24toTUN as a gateway to your network or the internet, or simply as a repository for sensor information. RF24Network addresses need to be assigned in the usual manner, and IP addresses can be configured as desired by the user. The master node (00) uses the Address Resolution Protocol (ARP) to find the appropriate nodes when IP traffic is forwarded though, and routes traffic to the correct RF24Network address. This provides a fairly seamless interaction, since users only need to configure standard IP forwarding and firewall rules as desired.</p>
<h1><a class="anchor" id="Config"></a>
Configuration and Setup</h1>
<p>RF24Ethernet requires the RF24 and RF24Network_DEV libraries found on my github repository at <a href="https://github.com/TMRh20">https://github.com/TMRh20</a> <br/>
 <br/>
 <b> RPi </b></p>
<ol type="1">
<li>On the Raspberry Pi, a companion program, RF24toTUN must be installed along with the RF24 and RF24Network libraries</li>
<li>Edit the included rf24totun_configAndPing.sh to modify the IP information to suit your desired network config</li>
<li>Run<div class="fragment"><div class="line">sudo ./rf24totun_configAndPing.sh 2 3 </div>
</div><!-- fragment --></li>
<li>The '2' specifies the last octet of the RPi IP address. The '3' specifies the last octet of the node it will attempt to ping once started.</li>
<li>Raspberry Pi defaults to the master node (00). Secondary Raspberry pi nodes would need the MAC address modified accordingly. *</li>
</ol>
<p><b> Arduino </b></p>
<ol type="1">
<li>For Arduino devices, the RF24, RF24Network and RF24Ethernet libraries need to be installed.</li>
<li>Open the included Getting_Started_SimpleServer or Getting_Started_SimpleClient example</li>
<li>Configure the RF24Network address (see <a href="http://tmrh20.github.io/RF24Network_Dev/">http://tmrh20.github.io/RF24Network_Dev/</a> for more info)</li>
<li>Configure the IP address according to your preferences, with the gateway set to the chosen IP of the RPi.</li>
<li>Connect into your nodes web-server at <a href="http://ip-of-your-node:1000">http://ip-of-your-node:1000</a> from the RPi or configure the client sketch to connect to a server running on the Raspberry Pi. Note: To minimize memory usage on Arduino, edit RF24Network_config.h with a text editor, and uncomment #define DISABLE_USER_PAYLOADS. This will disable standard RF24Network messages, and only allow external data, such as TCP/IP information.</li>
</ol>
<p><b>Accessing External Systems: Forwarding and Routing</b></p>
<p>In order to give your network or nodes access to your network or the internet beyond the RPi, it needs to be configured to route traffic between the networks.</p>
<ol type="1">
<li>Run<div class="fragment"><div class="line">sudo sysctl -w net.ipv4.ip_forward=1 </div>
</div><!-- fragment --> to allow the RPi to forward requests between the network interfaces</li>
<li><div class="fragment"><div class="line">sudo iptables -t nat -A POSTROUTING -j MASQUERADE </div>
</div><!-- fragment --> to allow the RPi to perform NAT between the network interfaces <br/>
 <b>Note:</b> Users are responsible to manage further routing rules along with their IP traffic in order to prevent unauthorized access. Users may also need to add a static route to their PC or router to connect in to or ping the sensor nodes. </li>
</ol>
<h1><a class="anchor" id="Advanced"></a>
Advanced Configuration and Info</h1>
<p>Additional settings are available by editing the <a class="el" href="uip-conf_8h_source.html">uip-conf.h</a> file included with the library. The main option available is the #define UIP_CONF_BUFFER_SIZE setting, which will define the maximum available size of TCP payloads. The default is 120 bytes, but large values can speed up data transfers, since more data can be included in every payload. Very large values are untested. When modifying the UIP_CONF_BUFFER_SIZE setting, the #define MAX_PAYLOAD_SIZE must also be adjusted in the RF24Network_config.h file, to allow the network to pass the same size of payloads as RF24Ethernet accepts. RF24Ethernet provides an interface for TCP/IP, but does not really understand the concept of sockets, ports, etc. so all data received goes into the same incoming buffer currently. This behaviour may be modified in the future.</p>
<h1><a class="anchor" id="Limitations"></a>
Limitations</h1>
<p>The library is currently limited to TCP communications only, with statically assigned IP addresses. UDP frames can be up to 512 bytes in length, so additional functionality (DHCP/DNS) is limited by available memory. At this time, there are no immediate plans to develop UDP functionality.</p>
<h1><a class="anchor" id="MAC_Addys"></a>
MAC address formatting:</h1>
<p>RF24Ethernet uses a simple method of formatting the MAC addresses, using the first two bytes to store the RF24Network address, and the remaining four bytes to store the characters 'RF24', which makes identification of nodes via MAC address very simple using standard monitoring tools.</p>
<table class="doxtable">
<tr>
<th>RF24Network Address</th><th>Byte 0 </th><th>Byte 1 </th><th>Byte 2 </th><th>Byte 3 </th><th>Byte 4 </th><th>Byte 5  </th></tr>
<tr>
<td>n/a </td><td>Octal LB</td><td>Octal HB</td><td>R </td><td>F </td><td>2 </td><td>4 </td></tr>
<tr>
<td>01 </td><td>0x01 </td><td>0x00 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td></tr>
<tr>
<td>011 </td><td>0x09 </td><td>0x00 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td></tr>
<tr>
<td>0443 </td><td>0x23 </td><td>0x01 </td><td>0x52 </td><td>0x46 </td><td>0x32 </td><td>0x34 </td></tr>
</table>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Dec 6 2014 09:03:53 for RF24Ethernet - TCP/IP over RF24Network by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
